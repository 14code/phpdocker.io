###############################################################################
#                          Generated on phpdocker.io                          #
###############################################################################
{% if memcached %}
{{ projectNameSlug }}-memcached:
  image: memcached:latest
  container_name: {{ projectNameSlug }}-memcached
{% endif %}

{% if mailcatcher %}
{{ projectNameSlug }}-mailcatcher:
  image: pataquets/mailcatcher
  container_name: {{ projectNameSlug }}-mailcatcher
  ports:
    - "{{ mailcatcherPort }}:1080"
{% endif %}

{% if redis %}
{{ projectNameSlug }}-redis:
  image: redis:latest
  container_name: {{ projectNameSlug }}-redis
{% endif %}

{% if mysql.hasMysql() %}
{{ projectNameSlug }}-mysql:
  image: mysql:latest
  container_name: {{ projectNameSlug }}-database
  environment:
    - MYSQL_ROOT_PASSWORD={{ mysql.getRootPassword() }}
    - MYSQL_DATABASE={{ mysql.getRootPassword() }}
    - MYSQL_USER={{ mysql.getUsername() }}
    - MYSQL_PASSWORD={{ mysql.getPassword() }}
{% endif %}

{{ projectNameSlug }}-webserver:
  build: .
  dockerfile: docker/Dockerfile.nginx.conf
  container_name: {{ projectNameSlug }}-webserver
  volumes:
      - ..:{{ workdir }}
  ports:
   - "{{ webserverPort }}:80"
  links:
   - {{ projectNameSlug }}-php-fpm

{{ projectNameSlug }}-php-fpm:
  build: .
  dockerfile: docker/Dockerfile.php-fpm.conf
  container_name: {{ projectNameSlug }}-php
  volumes:
    - ..:{{ workdir }}

{% if mysql.hasMysql() or memcached or mailcatcher %}
  links:
  {% if memcached %}  - {{ projectNameSlug }}-memcached{% endif %}
  {% if mailcatcher %}  - {{ projectNameSlug }}-mailcatcher{% endif %}
  {% if mysql.hasMysql() %}  - {{ projectNameSlug }}-mysql{% endif %}
  {% if redis %}  - {{ projectNameSlug }}-redis{% endif %}
{% endif %}
