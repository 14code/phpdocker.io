{% if memcachedHostname %}
{{ memcachedHostname }}:
  image: memcached:latest
  container_name: {{ memcachedHostname }}
{% endif %}

{% if mailhogHostname %}
{{ mailhogHostname }}:
  image: diyan/mailhog
  container_name: {{ mailhogHostname }}
  ports:
    - "{{ mailhogPort }}:8025"
{% endif %}

{% if redisHostname %}
{{ redisHostname }}:
  image: redis:latest
  container_name: {{ redisHostname }}
{% endif %}

{% if mysqlHostname %}
{{ mysqlHostname }}:
  image: mysql:latest
  container_name: {{ mysqlHostname }}
  environment:
    - MYSQL_ROOT_PASSWORD={{ mysql.getRootPassword() }}
    - MYSQL_DATABASE={{ mysql.getRootPassword() }}
    - MYSQL_USER={{ mysql.getUsername() }}
    - MYSQL_PASSWORD={{ mysql.getPassword() }}
{% endif %}

{{ webserverHostname }}:
  build: .
  dockerfile: docker/Dockerfile.nginx.conf
  container_name: {{ webserverHostname }}
  volumes:
      - ..:{{ workdir }}
  ports:
   - "{{ webserverPort }}:80"
  links:
   - {{ phpFpmHostname }}

{{ phpFpmHostname }}:
  build: .
  dockerfile: docker/Dockerfile.php-fpm.conf
  container_name: {{ phpFpmHostname }}
  volumes:
    - ..:{{ workdir }}
{% if mysqlHostname or memcachedHostname or mailhogHostname or redisHostname %}
  links:
{% if memcachedHostname %}    - {{ memcachedHostname }}{{ "\n" }}{% endif %}
{% if mailhogHostname %}    - {{ mailhogHostname }}{{ "\n" }}{% endif %}
{% if mysqlHostname %}    - {{ mysqlHostname }}{{ "\n" }}{% endif %}
{% if redisHostname %}    - {{ redisHostname }}{% endif %}
{% endif %}
